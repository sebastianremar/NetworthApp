generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model PlaidItem {
  id              String    @id @default(cuid())
  userId          String    // Clerk user ID
  accessToken     String    // Plaid access token
  itemId          String    @unique // Plaid's item ID
  institutionId   String?
  institutionName String?
  accounts        Account[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([userId])
}

model Account {
  id               String           @id @default(cuid())
  userId           String           // Clerk user ID (denormalized for easy queries)
  plaidItemId      String
  plaidItem        PlaidItem        @relation(fields: [plaidItemId], references: [id], onDelete: Cascade)
  plaidAccountId   String           @unique // Plaid's account ID
  name             String
  officialName     String?
  type             String           // depository, credit, loan, investment
  subtype          String?          // checking, savings, credit card, etc.
  mask             String?          // Last 4 digits
  currentBalance   Float?
  availableBalance Float?
  isoCurrencyCode  String?
  balanceHistory   BalanceHistory[]
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@index([userId])
}

model BalanceHistory {
  id        String   @id @default(cuid())
  accountId String
  account   Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  balance   Float
  date      DateTime @default(now())

  @@index([accountId, date])
}
